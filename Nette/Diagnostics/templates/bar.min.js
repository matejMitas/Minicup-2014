!function(){var t=Nette.Query.factory,e=Nette.DebugPanel=function(e){this.id="nette-debug-panel-"+e,this.elem=t("#"+this.id)};e.PEEK="nette-mode-peek",e.FLOAT="nette-mode-float",e.WINDOW="nette-mode-window",e.FOCUSED="nette-focused",e.zIndex=2e4,e.prototype.init=function(){var t=this;this.elem.data().onmove=function(e){t.moveConstrains(this,e)},this.elem.draggable({rightEdge:!0,bottomEdge:!0,handle:this.elem.find("h1"),stop:function(){t.toFloat()}}).bind("mouseenter",function(){t.focus()}).bind("mouseleave",function(){t.blur()}),this.elem.find(".nette-icons").find("a").bind("click",function(e){"close"===this.rel?t.toPeek():t.toWindow(),e.preventDefault()}),this.restorePosition()},e.prototype.is=function(t){return this.elem.hasClass(t)},e.prototype.focus=function(t){var o=this.elem;this.is(e.WINDOW)?o.data().win.focus():(clearTimeout(o.data().displayTimeout),o.data().displayTimeout=setTimeout(function(){o.addClass(e.FOCUSED).show(),o[0].style.zIndex=e.zIndex++,t&&t()},50))},e.prototype.blur=function(){var t=this.elem;t.removeClass(e.FOCUSED),this.is(e.PEEK)&&(clearTimeout(t.data().displayTimeout),t.data().displayTimeout=setTimeout(function(){t.hide()},50))},e.prototype.toFloat=function(){this.elem.removeClass(e.WINDOW).removeClass(e.PEEK).addClass(e.FLOAT).show(),this.reposition()},e.prototype.toPeek=function(){this.elem.removeClass(e.WINDOW).removeClass(e.FLOAT).addClass(e.PEEK).hide(),document.cookie=this.id+"=; path=/"},e.prototype.toWindow=function(){var o=this.elem.offset();o.left+="number"==typeof window.screenLeft?window.screenLeft:window.screenX+10,o.top+="number"==typeof window.screenTop?window.screenTop:window.screenY+50;var i=window.open("",this.id.replace(/-/g,"_"),"left="+o.left+",top="+o.top+",width="+o.width+",height="+(o.height+15)+",resizable=yes,scrollbars=yes");if(i){var n=i.document;n.write('<!DOCTYPE html><meta charset="utf-8"><style>'+t("#nette-debug-style").dom().innerHTML+"</style><script>"+t("#nette-debug-script").dom().innerHTML+'</script><body id="nette-debug">'),n.body.innerHTML='<div class="nette-panel nette-mode-window" id="'+this.id+'">'+this.elem.dom().innerHTML+"</div>";var s=i.Nette.Debug.getPanel(this.id);i.Nette.Dumper.init(),s.reposition(),n.title=this.elem.find("h1").dom().innerHTML;var r=this;t([i]).bind("unload",function(){r.toPeek(),i.close()}),t(n).bind("keyup",function(t){27!==t.keyCode||t.shiftKey||t.altKey||t.ctrlKey||t.metaKey||i.close()}),document.cookie=this.id+"=window; path=/",this.elem.hide().removeClass(e.FLOAT).removeClass(e.PEEK).addClass(e.WINDOW).data().win=i}},e.prototype.reposition=function(){if(this.is(e.WINDOW)){var t=document.documentElement;window.resizeBy(t.scrollWidth-t.clientWidth,t.scrollHeight-t.clientHeight)}else{var o=this.elem.position();o.width&&(this.elem.position({right:o.right,bottom:o.bottom}),document.cookie=this.id+"="+o.right+":"+o.bottom+"; path=/")}},e.prototype.moveConstrains=function(t,e){var o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;e.right=Math.min(Math.max(e.right,-.2*t.offsetWidth),o-.8*t.offsetWidth),e.bottom=Math.min(Math.max(e.bottom,-.2*t.offsetHeight),i-t.offsetHeight)},e.prototype.restorePosition=function(){var t=document.cookie.match(new RegExp(this.id+"=(window|(-?[0-9]+):(-?[0-9]+))"));t&&t[2]?(this.elem.position({right:t[2],bottom:t[3]}),this.toFloat()):t?this.toWindow():this.elem.addClass(e.PEEK)};var o=Nette.DebugBar=function(){};o.prototype.id="nette-debug-bar",o.prototype.init=function(){var o=t("#"+this.id),n=this;o.data().onmove=function(t){n.moveConstrains(this,t)},o.draggable({rightEdge:!0,bottomEdge:!0,draggedClass:"nette-dragged",stop:function(){n.savePosition()}}),o.find("a").bind("click",function(t){if("close"===this.rel)n.close();else if(this.rel){var o=i.getPanel(this.rel);t.shiftKey?(o.toFloat(),o.toWindow()):o.is(e.FLOAT)?o.toPeek():(o.toFloat(),o.elem.position({right:o.elem.position().right+Math.round(100*Math.random())+20,bottom:o.elem.position().bottom+Math.round(100*Math.random())+20}),o.reposition())}t.preventDefault()}).bind("mouseenter",function(){if(this.rel&&"close"!==this.rel&&!o.hasClass("nette-dragged")){var n=i.getPanel(this.rel),s=t(this);n.focus(function(){n.is(e.PEEK)&&n.elem.position({right:n.elem.position().right-s.offset().left+n.elem.position().width-s.position().width-4+n.elem.offset().left,bottom:n.elem.position().bottom-o.offset().top+n.elem.position().height+4+n.elem.offset().top})})}}).bind("mouseleave",function(){this.rel&&"close"!==this.rel&&!o.hasClass("nette-dragged")&&i.getPanel(this.rel).blur()}),this.restorePosition()},o.prototype.close=function(){t("#nette-debug").hide(),window.opera&&t("body").show()},o.prototype.moveConstrains=function(t,e){var o=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,i=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;e.right=Math.min(Math.max(e.right,0),o-t.offsetWidth),e.bottom=Math.min(Math.max(e.bottom,0),i-t.offsetHeight)},o.prototype.savePosition=function(){var e=t("#"+this.id).position();document.cookie=this.id+"="+e.right+":"+e.bottom+"; path=/"},o.prototype.restorePosition=function(){var e=document.cookie.match(new RegExp(this.id+"=(-?[0-9]+):(-?[0-9]+)"));e&&t("#"+this.id).position({right:e[1],bottom:e[2]})};var i=Nette.Debug={};i.init=function(){i.initResize(),(new o).init(),t(".nette-panel").each(function(){i.getPanel(this.id).init()})},i.getPanel=function(t){return new e(t.replace("nette-debug-panel-",""))},i.initResize=function(){t(window).bind("resize",function(){var e=t("#"+o.prototype.id);e.position({right:e.position().right,bottom:e.position().bottom}),t(".nette-panel").each(function(){i.getPanel(this.id).reposition()})})}}();